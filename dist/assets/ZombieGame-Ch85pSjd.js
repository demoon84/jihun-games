import{b as m,j as r}from"./index-CPPkEWNz.js";class D{constructor(e,i){this.x=e,this.y=i,this.hp=150,this.maxHp=150,this.radius=32,this.speed=4.5,this.vx=0,this.vy=0,this.skillGauge=0,this.maxSkillGauge=100}update(e){if(this.x,this.y,e.input.active){const i=e.input.x-this.x,n=e.input.y-this.y,a=Math.sqrt(i*i+n*n);a>5?(this.vx=i/a*this.speed,this.vy=n/a*this.speed,this.x+=this.vx,this.y+=this.vy):(this.vx*=.9,this.vy*=.9)}else this.vx*=.9,this.vy*=.9;this.x=Math.max(this.radius,Math.min(e.width-this.radius,this.x)),this.y=Math.max(this.radius,Math.min(e.height-this.radius,this.y))}draw(e,i){const n=e.createRadialGradient(this.x,this.y,0,this.x,this.y,this.radius+20);n.addColorStop(0,"rgba(251, 191, 36, 0.4)"),n.addColorStop(1,"rgba(251, 191, 36, 0)"),e.beginPath(),e.arc(this.x,this.y,this.radius+20,0,Math.PI*2),e.fillStyle=n,e.fill(),e.beginPath(),e.arc(this.x,this.y,this.radius,0,Math.PI*2),e.strokeStyle="#fbbf24",e.lineWidth=4,e.stroke(),e.beginPath(),e.arc(this.x,this.y,this.radius-2,0,Math.PI*2),e.fillStyle="#1e1b4b",e.fill(),e.fillStyle="#fbbf24",e.font="bold 20px sans-serif",e.textAlign="center",e.textBaseline="middle",e.fillText("â™”",this.x,this.y);const a=80;e.fillStyle="#374151",e.fillRect(this.x-a/2,this.y+this.radius+15,a,8),e.fillStyle="#ef4444",e.fillRect(this.x-a/2,this.y+this.radius+15,a*(this.hp/this.maxHp),8),e.strokeStyle="#000",e.lineWidth=1,e.strokeRect(this.x-a/2,this.y+this.radius+15,a,8)}}class b{constructor(e,i="infantry"){this.index=e,this.type=i,this.x=0,this.y=0,this.radius=i==="infantry"?20:16,this.hp=i==="infantry"?100:50,this.attackCooldown=0,this.color=i==="infantry"?"#60a5fa":"#f87171"}update(e){const i=e.leader;let n,a;if(this.type==="infantry"){const l=this.index/4*Math.PI*2+e.frameCount*.02;n=i.x+Math.cos(l)*70,a=i.y+Math.sin(l)*70}else{const l=Math.atan2(i.vy,i.vx)+Math.PI,c=Math.floor((this.index-4)/4)+1,f=(this.index-4)%4-1.5,p=Math.cos(l)*(c*60)+Math.cos(l+Math.PI/2)*(f*40),g=Math.sin(l)*(c*60)+Math.sin(l+Math.PI/2)*(f*40);if(Math.abs(i.vx)<.1&&Math.abs(i.vy)<.1){const v=this.index/8*Math.PI*2-e.frameCount*.01;n=i.x+Math.cos(v)*120,a=i.y+Math.sin(v)*120}else n=i.x+p,a=i.y+g}if(this.x+=(n-this.x)*.15,this.y+=(a-this.y)*.15,this.attackCooldown>0&&this.attackCooldown--,this.attackCooldown<=0){const l=this.type==="archer"?e.stats.range*1.5:e.stats.range,c=this.findTarget(e,l);c&&(this.shoot(e,c),this.attackCooldown=Math.floor(60/(this.type==="archer"?e.stats.atkSpd*1.2:e.stats.atkSpd)))}}findTarget(e,i){let n=null,a=i;for(const l of e.enemies){const c=l.x-this.x,f=l.y-this.y,p=Math.sqrt(c*c+f*f);p<a&&(a=p,n=l)}return n}shoot(e,i){const n=i.x-this.x,a=i.y-this.y,l=Math.sqrt(n*n+a*a),c=this.type==="archer"?e.stats.dmg*1.4:e.stats.dmg;e.projectiles.push(new H(this.x,this.y,n/l*10,a/l*10,c,e.stats.crit,this.color))}draw(e){e.beginPath(),e.arc(this.x,this.y,this.radius,0,Math.PI*2),e.fillStyle=this.color,e.fill(),e.strokeStyle="#fff",e.lineWidth=2,e.stroke(),e.fillStyle="#fff",e.font="12px sans-serif",e.textAlign="center",e.textBaseline="middle",e.fillText(this.type==="infantry"?"ðŸ›¡ï¸":"ðŸ¹",this.x,this.y)}}class F{constructor(e,i,n){this.x=e,this.y=i,this.radius=22+Math.random()*10,this.speed=1.2+Math.random()*.8,this.hp=40+n*8,this.maxHp=this.hp,this.damage=8+Math.floor(n/2),this.attackCooldown=0}update(e,i){const n=e.leader.x-this.x,a=e.leader.y-this.y,l=Math.sqrt(n*n+a*a);l>e.leader.radius+this.radius?(this.x+=n/l*this.speed,this.y+=a/l*this.speed):this.attackCooldown<=0&&(e.leader.hp-=this.damage,e.leader.skillGauge=Math.min(e.leader.maxSkillGauge,e.leader.skillGauge+2),this.attackCooldown=60,e.leader.hp<=0&&i()),this.attackCooldown>0&&this.attackCooldown--}draw(e){e.beginPath(),e.arc(this.x,this.y,this.radius,0,Math.PI*2),e.fillStyle="#14532d",e.fill(),e.strokeStyle="#22c55e",e.lineWidth=2,e.stroke(),e.fillStyle="#ef4444",e.beginPath(),e.arc(this.x-6,this.y-4,3,0,Math.PI*2),e.fill(),e.beginPath(),e.arc(this.x+6,this.y-4,3,0,Math.PI*2),e.fill()}}class H{constructor(e,i,n,a,l,c,f){this.x=e,this.y=i,this.vx=n,this.vy=a,this.dmg=l,this.crit=c,this.color=f,this.radius=5,this.life=100}update(e,i,n){this.x+=this.vx,this.y+=this.vy,this.life--;for(let a=e.enemies.length-1;a>=0;a--){const l=e.enemies[a],c=l.x-this.x,f=l.y-this.y;if(Math.sqrt(c*c+f*f)<l.radius+this.radius){const g=Math.random()<this.crit;l.hp-=g?this.dmg*2:this.dmg,l.hp<=0&&n(a),i(this.x,this.y,g?"#fbbf24":this.color,4),this.life=0;break}}}draw(e){e.beginPath(),e.arc(this.x,this.y,this.radius,0,Math.PI*2),e.fillStyle=this.color,e.fill()}}function X(){const y=m.useRef(null),e=m.useRef(null),[i,n]=m.useState(!1),[a,l]=m.useState(1),[c,f]=m.useState(0),[p,g]=m.useState(100),[v,G]=m.useState(0),[R,E]=m.useState(!1),[M,N]=m.useState(!1),[L,A]=m.useState([]),u=m.useRef({level:1,exp:0,maxExp:100,leader:null,units:[],enemies:[],projectiles:[],particles:[],input:{x:0,y:0,active:!1},stats:{dmg:15,range:200,atkSpd:1,crit:.05,spawnRate:100},width:0,height:0,frameCount:0,gameTime:0,isPaused:!1});m.useEffect(()=>{const o=y.current,d=o.getContext("2d"),T=()=>{N(!0),n(!1)},S=(t,s,h,x=8)=>{for(let w=0;w<x;w++)u.current.particles.push({x:t,y:s,vx:(Math.random()-.5)*6,vy:(Math.random()-.5)*6,alpha:1,color:h,size:Math.random()*3+1})},z=t=>{const s=u.current;S(s.enemies[t].x,s.enemies[t].y,"#22c55e"),s.enemies.splice(t,1),s.leader.skillGauge=Math.min(s.leader.maxSkillGauge,s.leader.skillGauge+5),q(25)},q=t=>{const s=u.current;s.exp+=t,s.exp>=s.maxExp&&(s.level++,s.exp=0,s.maxExp=Math.floor(s.maxExp*1.35),s.isPaused=!0,l(s.level),g(s.maxExp),O()),f(s.exp)},O=()=>{const t=u.current;A([{title:"ðŸ›¡ï¸ ë³´ë³‘ ì¶”ê°€",desc:"ì „ì—´ì„ ë°©ì–´í•  ë³´ë³‘ì„ ì˜ìž…í•©ë‹ˆë‹¤.",action:()=>t.units.push(new b(t.units.length,"infantry"))},{title:"ðŸ¹ ê¶ë³‘ ì¶”ê°€",desc:"í›„ë°© í™”ë ¥ì„ ì§€ì›í•  ê¶ë³‘ì„ ì˜ìž…í•©ë‹ˆë‹¤.",action:()=>t.units.push(new b(t.units.length,"archer"))},{title:"âš”ï¸ ê³µê²©ë ¥ ì¦ê°•",desc:"ëª¨ë“  ë¶€ëŒ€ì˜ ê³µê²©ë ¥ì´ 20% ìƒìŠ¹í•©ë‹ˆë‹¤.",action:()=>t.stats.dmg*=1.2},{title:"ðŸ¹ ì‚¬ê±°ë¦¬ í™•ìž¥",desc:"ê¶ë³‘ë“¤ì˜ ì‚¬ê±°ë¦¬ê°€ í¬ê²Œ ì¦ê°€í•©ë‹ˆë‹¤.",action:()=>t.stats.range*=1.25},{title:"â¤ï¸ êµ°ë‹¨ ì •ë¹„",desc:"ì‚¬ë ¹ê´€ê³¼ ë¶€ëŒ€ì˜ ì²´ë ¥ì„ íšŒë³µí•©ë‹ˆë‹¤.",action:()=>t.leader.hp=Math.min(t.leader.maxHp,t.leader.hp+50)}].sort(()=>.5-Math.random()).slice(0,3)),E(!0)},W=()=>{const t=u.current;if(!(t.leader.skillGauge<t.leader.maxSkillGauge)){t.leader.skillGauge=0,S(t.leader.x,t.leader.y,"#fbbf24",50);for(let s=t.enemies.length-1;s>=0;s--){const h=t.enemies[s],x=h.x-t.leader.x,w=h.y-t.leader.y;Math.sqrt(x*x+w*w)<400&&(h.hp-=200,h.hp<=0&&z(s))}}},I=t=>{t.code==="Space"&&W()};window.addEventListener("keydown",I);const j=()=>{const t=u.current;if(!i||t.isPaused){i&&(e.current=requestAnimationFrame(j));return}d.fillStyle="#0a0a0a",d.fillRect(0,0,t.width,t.height),d.strokeStyle="#1a1a1a",d.lineWidth=1;for(let s=0;s<t.width;s+=80)d.beginPath(),d.moveTo(s,0),d.lineTo(s,t.height),d.stroke();for(let s=0;s<t.height;s+=80)d.beginPath(),d.moveTo(0,s),d.lineTo(t.width,s),d.stroke();if(t.leader.update(t),t.leader.draw(d,t),G(t.leader.skillGauge),t.frameCount%t.stats.spawnRate===0){let s,h,x=Math.floor(Math.random()*4);x===0?(s=Math.random()*t.width,h=-50):x===1?(s=t.width+50,h=Math.random()*t.height):x===2?(s=Math.random()*t.width,h=t.height+50):(s=-50,h=Math.random()*t.height),t.enemies.push(new F(s,h,t.level))}for(let s=t.projectiles.length-1;s>=0;s--)t.projectiles[s].update(t,S,z),t.projectiles[s].draw(d),t.projectiles[s].life<=0&&t.projectiles.splice(s,1);for(let s=t.enemies.length-1;s>=0;s--)t.enemies[s].update(t,T),t.enemies[s].draw(d);t.units.forEach(s=>{s.update(t),s.draw(d)});for(let s=t.particles.length-1;s>=0;s--){const h=t.particles[s];h.x+=h.vx,h.y+=h.vy,h.alpha-=.03,h.alpha<=0?t.particles.splice(s,1):(d.globalAlpha=h.alpha,d.fillStyle=h.color,d.beginPath(),d.arc(h.x,h.y,h.size,0,Math.PI*2),d.fill(),d.globalAlpha=1)}t.frameCount++,e.current=requestAnimationFrame(j)},P=()=>{o.width=window.innerWidth,o.height=window.innerHeight,u.current.width=o.width,u.current.height=o.height},k=t=>{const s=t.touches?t.touches[0].clientX:t.clientX,h=t.touches?t.touches[0].clientY:t.clientY;u.current.input.x=s,u.current.input.y=h,u.current.input.active=!0};return window.addEventListener("resize",P),o.addEventListener("mousedown",k),o.addEventListener("mousemove",t=>{u.current.input.active&&k(t)}),o.addEventListener("mouseup",()=>u.current.input.active=!1),o.addEventListener("touchstart",t=>{k(t),t.preventDefault()},{passive:!1}),o.addEventListener("touchmove",t=>{k(t),t.preventDefault()},{passive:!1}),o.addEventListener("touchend",()=>u.current.input.active=!1),P(),i&&(e.current=requestAnimationFrame(j)),()=>{window.removeEventListener("resize",P),window.removeEventListener("keydown",I),cancelAnimationFrame(e.current)}},[i]);const C=()=>{const o=u.current;o.leader=new D(window.innerWidth/2,window.innerHeight/2),o.units=[new b(0,"infantry"),new b(1,"infantry"),new b(2,"archer"),new b(3,"archer")],o.enemies=[],o.projectiles=[],o.particles=[],o.level=1,o.exp=0,o.frameCount=0,N(!1),n(!0),l(1),f(0)};return r.jsxs("div",{className:"relative w-full h-screen bg-black overflow-hidden font-sans select-none touch-none",children:[r.jsx("canvas",{ref:y,className:"block w-full h-full"}),i&&!M&&r.jsxs("div",{className:"absolute top-0 left-0 w-full p-6 flex justify-between items-start pointer-events-none",children:[r.jsxs("div",{className:"flex flex-col gap-2",children:[r.jsxs("div",{className:"text-3xl font-black text-amber-400 drop-shadow-md",children:["COMMANDER LV.",a]}),r.jsx("div",{className:"w-64 h-3 bg-zinc-900 rounded-full border border-zinc-700 overflow-hidden",children:r.jsx("div",{className:"h-full bg-amber-500 transition-all duration-300",style:{width:`${c/p*100}%`}})})]}),r.jsx("div",{className:"flex flex-col items-end gap-3",children:r.jsxs("div",{className:"relative group pointer-events-auto cursor-pointer",onClick:()=>{},children:[r.jsx("div",{className:"text-xs text-amber-300 font-bold mb-1 text-center",children:"SKILL (SPACE)"}),r.jsxs("div",{className:"w-20 h-20 rounded-full border-4 border-zinc-800 bg-zinc-950 flex items-center justify-center overflow-hidden",children:[r.jsx("div",{className:"absolute bottom-0 w-full bg-amber-600/40 transition-all duration-300",style:{height:`${v}%`}}),r.jsx("span",{className:"text-3xl z-10",children:v>=100?"ðŸ”¥":"âš¡"})]})]})})]}),!i&&!M&&r.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center bg-black/80 z-50",children:[r.jsx("h1",{className:"text-7xl text-amber-500 font-black mb-4 tracking-tighter text-center italic",children:"RISE OF SURVIVORS"}),r.jsx("p",{className:"text-zinc-400 mb-10 text-lg text-center font-light",children:"ì „ì„¤ì˜ ì‚¬ë ¹ê´€ì´ ë˜ì–´ ì¢€ë¹„ êµ°ë‹¨ì„ ì •ë²Œí•˜ì„¸ìš”."}),r.jsx("button",{onClick:C,className:"px-16 py-6 bg-amber-600 hover:bg-amber-500 text-white text-3xl font-black rounded-full shadow-[0_0_40px_rgba(217,119,6,0.5)] transition-all active:scale-95",children:"ì›ì • ì‹œìž‘"})]}),M&&r.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center bg-black/95 z-50",children:[r.jsx("h1",{className:"text-8xl text-red-600 font-black mb-6",children:"DEFEAT"}),r.jsx("button",{onClick:C,className:"px-12 py-4 bg-zinc-800 text-white text-xl font-bold rounded-xl",children:"ë‹¤ì‹œ ë„ì „"})]}),R&&r.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/90 z-50",children:r.jsxs("div",{className:"bg-zinc-950 p-8 rounded-3xl border-4 border-amber-600 max-w-sm w-full shadow-2xl",children:[r.jsx("h2",{className:"text-4xl text-amber-500 font-black text-center mb-8 uppercase tracking-widest",children:"Victory!"}),r.jsx("div",{className:"space-y-4",children:L.map((o,d)=>r.jsxs("div",{onClick:()=>{o.action(),E(!1),u.current.isPaused=!1},className:"p-5 rounded-2xl bg-zinc-900 hover:bg-amber-900/40 border-2 border-zinc-800 hover:border-amber-500 cursor-pointer transition-all group",children:[r.jsx("div",{className:"text-xl font-bold text-amber-400 mb-1 group-hover:text-white",children:o.title}),r.jsx("div",{className:"text-sm text-zinc-500 group-hover:text-zinc-300",children:o.desc})]},d))})]})})]})}export{X as default};
