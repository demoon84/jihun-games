import{r as m,j as o}from"./index-DuMMiI8Q.js";class Y{constructor(t,s){this.x=t,this.y=s,this.hp=100,this.maxHp=100,this.radius=30,this.speed=5}update(t){if(t.input.active){const s=t.input.x-this.x,i=t.input.y-this.y,r=Math.sqrt(s*s+i*i);r>5&&(this.x+=s/r*this.speed,this.y+=i/r*this.speed)}this.x=Math.max(this.radius,Math.min(t.width-this.radius,this.x)),this.y=Math.max(this.radius,Math.min(t.height-this.radius,this.y))}draw(t,s){const i=t.createRadialGradient(this.x,this.y,0,this.x,this.y,this.radius+15);i.addColorStop(0,"rgba(255, 255, 255, 0.8)"),i.addColorStop(1,"rgba(255, 255, 255, 0)"),t.beginPath(),t.arc(this.x,this.y,this.radius+15,0,Math.PI*2),t.fillStyle=i,t.fill(),t.beginPath(),t.arc(this.x,this.y,this.radius,0,Math.PI*2),t.fillStyle="#ffffff",t.fill(),t.beginPath(),t.moveTo(this.x,this.y-12),t.lineTo(this.x-10,this.y+8),t.lineTo(this.x+10,this.y+8),t.closePath(),t.fillStyle="#fbbf24",t.fill();const r=60,h=8;t.fillStyle="#dc2626",t.fillRect(this.x-r/2,this.y+this.radius+10,r*(this.hp/this.maxHp),h)}}class A{constructor(t,s,i){this.x=t,this.y=s,this.index=i,this.radius=18,this.attackCooldown=0,this.angle=i/3*Math.PI*2}update(t){const s=this.angle+t.frameCount*.015,i=70+this.index*25,r=t.leader.x+Math.cos(s)*i,h=t.leader.y+Math.sin(s)*i;if(this.x+=(r-this.x)*t.stats.followerSpeed,this.y+=(h-this.y)*t.stats.followerSpeed,this.attackCooldown>0&&this.attackCooldown--,this.attackCooldown<=0){const u=this.findTarget(t);u&&(this.shoot(t,u),this.attackCooldown=Math.floor(60/t.stats.attackSpeed))}}findTarget(t){let s=null,i=t.stats.followerRange;for(const r of t.enemies){const h=r.x-this.x,u=r.y-this.y,p=Math.sqrt(h*h+u*u);p<i&&(i=p,s=r)}return s}shoot(t,s){const i=s.x-this.x,r=s.y-this.y,h=Math.sqrt(i*i+r*r);t.projectiles.push(new V(this.x,this.y,i/h*8,r/h*8,t.stats.followerAtk,t.stats.critChance,t.stats.knockback))}draw(t){const s=t.createRadialGradient(this.x,this.y,0,this.x,this.y,this.radius+5);s.addColorStop(0,"#3b82f6"),s.addColorStop(1,"rgba(59, 130, 246, 0)"),t.beginPath(),t.arc(this.x,this.y,this.radius+5,0,Math.PI*2),t.fillStyle=s,t.fill(),t.beginPath(),t.arc(this.x,this.y,this.radius,0,Math.PI*2),t.fillStyle="#3b82f6",t.fill(),t.beginPath(),t.arc(this.x,this.y-3,5,0,Math.PI*2),t.fillStyle="#ffffff",t.fill()}}class _{constructor(t,s,i,r){this.x=t,this.y=s,this.type=i,this.radius=i==="tank"?35:i==="fast"?18:25,this.speed=i==="fast"?2.5:i==="tank"?1:1.5,this.hp=i==="tank"?80+r*10:i==="fast"?20+r*3:40+r*5,this.maxHp=this.hp,this.damage=i==="tank"?15:i==="fast"?5:10,this.attackCooldown=0}update(t,s){const i=t.leader.x-this.x,r=t.leader.y-this.y,h=Math.sqrt(i*i+r*r);h>t.leader.radius+this.radius?(this.x+=i/h*this.speed,this.y+=r/h*this.speed):this.attackCooldown<=0&&(t.leader.hp-=this.damage,this.attackCooldown=60,t.leader.hp<=0&&s()),this.attackCooldown>0&&this.attackCooldown--}draw(t){const s=this.type==="tank"?"#166534":this.type==="fast"?"#4ade80":"#22c55e";t.beginPath(),t.arc(this.x,this.y,this.radius,0,Math.PI*2),t.fillStyle=s,t.fill(),t.strokeStyle=s,t.lineWidth=3,t.beginPath(),t.moveTo(this.x-this.radius*.4,this.y-this.radius*.6),t.lineTo(this.x-this.radius*.6,this.y-this.radius*1.2),t.stroke(),t.beginPath(),t.moveTo(this.x+this.radius*.4,this.y-this.radius*.6),t.lineTo(this.x+this.radius*.6,this.y-this.radius*1.2),t.stroke(),t.beginPath(),t.arc(this.x-this.radius*.6,this.y-this.radius*1.2,4,0,Math.PI*2),t.fillStyle="#ef4444",t.fill(),t.beginPath(),t.arc(this.x+this.radius*.6,this.y-this.radius*1.2,4,0,Math.PI*2),t.fillStyle="#ef4444",t.fill(),t.beginPath(),t.arc(this.x-6,this.y-2,4,0,Math.PI*2),t.fillStyle="#ef4444",t.fill(),t.beginPath(),t.arc(this.x+6,this.y-2,4,0,Math.PI*2),t.fillStyle="#ef4444",t.fill()}}class V{constructor(t,s,i,r,h,u,p){this.x=t,this.y=s,this.vx=i,this.vy=r,this.damage=h,this.critChance=u,this.knockback=p,this.radius=6,this.life=120}update(t,s,i){this.x+=this.vx,this.y+=this.vy,this.life--;for(let r=t.enemies.length-1;r>=0;r--){const h=t.enemies[r],u=h.x-this.x,p=h.y-this.y,g=Math.sqrt(u*u+p*p);if(g<h.radius+this.radius){const b=Math.random()<this.critChance,M=b?this.damage*2:this.damage;h.hp-=M;const w=this.knockback*10;h.x+=u/g*w,h.y+=p/g*w,h.hp<=0&&i(r),s(this.x,this.y,b?"#fbbf24":"#60a5fa",5),this.life=0;break}}}draw(t){const s=t.createRadialGradient(this.x,this.y,0,this.x,this.y,this.radius+3);s.addColorStop(0,"#60a5fa"),s.addColorStop(1,"rgba(96, 165, 250, 0)"),t.beginPath(),t.arc(this.x,this.y,this.radius+3,0,Math.PI*2),t.fillStyle=s,t.fill(),t.beginPath(),t.arc(this.x,this.y,this.radius,0,Math.PI*2),t.fillStyle="#3b82f6",t.fill()}}function B(){const x=m.useRef(null),t=m.useRef(null),[s,i]=m.useState(!1),[r,h]=m.useState(1),[u,p]=m.useState(0),[g,b]=m.useState(100),[M,w]=m.useState(3),[G,C]=m.useState("00:00"),[L,N]=m.useState(!1),[j,E]=m.useState(!1),[q,H]=m.useState(""),[F,O]=m.useState([]),c=m.useRef({level:1,exp:0,maxExp:100,leader:null,followers:[],enemies:[],projectiles:[],particles:[],input:{x:0,y:0,active:!1},stats:{followerAtk:12,followerRange:180,followerSpeed:.06,attackSpeed:1,critChance:.05,knockback:.5,spawnRate:120,armorGlow:0},width:0,height:0,frameCount:0,gameTime:0,isPaused:!1}),R=l=>{const n=Math.floor(l/60),y=l%60;return`${n}:${y<10?"0"+y:y}`};m.useEffect(()=>{const l=x.current,n=l.getContext("2d"),y=()=>{H(`최종 레벨: ${c.current.level} | 생존 시간: ${R(c.current.gameTime)}`),E(!0),i(!1),cancelAnimationFrame(t.current)},I=(e,f,a,d=10)=>{const v=c.current;for(let k=0;k<d;k++)v.particles.push({x:e,y:f,vx:(Math.random()-.5)*6,vy:(Math.random()-.5)*6,alpha:1,color:a,size:Math.random()*3+1})},U=e=>{const f=c.current;I(f.enemies[e].x,f.enemies[e].y,"#22c55e"),f.enemies.splice(e,1),$(35)},$=e=>{const f=c.current;f.exp+=e,f.exp>=f.maxExp&&W(),p(f.exp)},W=()=>{const e=c.current;e.level++,e.exp=0,e.maxExp=Math.floor(e.maxExp*1.38),e.isPaused=!0,h(e.level),b(e.maxExp),D()},D=()=>{const e=c.current;O([{title:"수비대 충원",desc:"새로운 대원을 영입합니다.",action:()=>{e.followers.push(new A(e.leader.x,e.leader.y,e.followers.length)),w(a=>a+1)}},{title:"공격력 증강",desc:"대원들의 파괴력이 25% 상승합니다.",action:()=>e.stats.followerAtk*=1.25},{title:"연사 속도",desc:"공격 속도가 20% 빨라집니다.",action:()=>e.stats.attackSpeed*=1.2},{title:"치명타 상향",desc:"치명타 확률이 10% 증가합니다.",action:()=>e.stats.critChance+=.1},{title:"넉백 강화",desc:"적을 더 멀리 밀쳐냅니다.",action:()=>e.stats.knockback+=.4},{title:"사거리 증가",desc:"공격 사거리가 15% 넓어집니다.",action:()=>e.stats.followerRange*=1.15},{title:"응급 치료",desc:"리더의 체력을 30% 회복합니다.",action:()=>e.leader.hp=Math.min(e.leader.maxHp,e.leader.hp+30)},{title:"방어 시스템",desc:"보호막 생성 및 체력이 증가합니다.",action:()=>{e.stats.armorGlow+=1,e.leader.maxHp+=20,e.leader.hp+=20}}].sort(()=>.5-Math.random()).slice(0,3)),N(!0)},P=()=>{l&&(l.width=window.innerWidth,l.height=window.innerHeight,c.current.width=l.width,c.current.height=l.height)},z=()=>{const e=c.current;if(!s||e.isPaused){s&&(t.current=requestAnimationFrame(z));return}n.fillStyle="#0f0f0f",n.fillRect(0,0,e.width,e.height),n.strokeStyle="#1f1f1f",n.lineWidth=1;const f=100;for(let a=0;a<e.width;a+=f)n.beginPath(),n.moveTo(a,0),n.lineTo(a,e.height),n.stroke();for(let a=0;a<e.height;a+=f)n.beginPath(),n.moveTo(0,a),n.lineTo(e.width,a),n.stroke();if(e.leader&&(e.leader.update(e),e.leader.draw(n,e)),e.frameCount%e.stats.spawnRate===0){let a,d,v=Math.floor(Math.random()*4);v===0?(a=Math.random()*e.width,d=-50):v===1?(a=e.width+50,d=Math.random()*e.height):v===2?(a=Math.random()*e.width,d=e.height+50):(a=-50,d=Math.random()*e.height);let k=Math.random(),X=k>.92?"tank":k>.78?"fast":"normal";e.enemies.push(new _(a,d,X,e.level)),e.stats.spawnRate>40&&e.frameCount%300===0&&(e.stats.spawnRate-=5)}for(let a=e.projectiles.length-1;a>=0;a--)e.projectiles[a].update(e,I,U),e.projectiles[a].draw(n),e.projectiles[a].life<=0&&e.projectiles.splice(a,1);for(let a=e.enemies.length-1;a>=0;a--)e.enemies[a].update(e,y),e.enemies[a].draw(n);e.followers.forEach(a=>{a.update(e),a.draw(n)});for(let a=e.particles.length-1;a>=0;a--){const d=e.particles[a];d.x+=d.vx,d.y+=d.vy,d.alpha-=.025,d.alpha<=0?e.particles.splice(a,1):(n.globalAlpha=d.alpha,n.fillStyle=d.color,n.beginPath(),n.arc(d.x,d.y,d.size,0,Math.PI*2),n.fill(),n.globalAlpha=1)}e.frameCount++,e.frameCount%60===0&&(e.gameTime++,C(R(e.gameTime))),t.current=requestAnimationFrame(z)},S=e=>{const f=e.touches?e.touches[0].clientX:e.clientX,a=e.touches?e.touches[0].clientY:e.clientY;c.current.input.x=f,c.current.input.y=a,c.current.input.active=!0};return window.addEventListener("resize",P),l.addEventListener("mousedown",S),l.addEventListener("mousemove",e=>{c.current.input.active&&S(e)}),l.addEventListener("mouseup",()=>c.current.input.active=!1),l.addEventListener("touchstart",e=>{S(e),e.preventDefault()},{passive:!1}),l.addEventListener("touchmove",e=>{S(e),e.preventDefault()},{passive:!1}),l.addEventListener("touchend",()=>c.current.input.active=!1),P(),s&&(t.current=requestAnimationFrame(z)),()=>{window.removeEventListener("resize",P),cancelAnimationFrame(t.current)}},[s]);const T=()=>{const l=c.current;l.width=window.innerWidth,l.height=window.innerHeight,l.level=1,l.exp=0,l.maxExp=100,l.frameCount=0,l.gameTime=0,l.enemies=[],l.projectiles=[],l.particles=[],l.stats={followerAtk:12,followerRange:180,followerSpeed:.06,attackSpeed:1,critChance:.05,knockback:.5,spawnRate:120,armorGlow:0},l.isPaused=!1,l.leader=new Y(l.width/2,l.height/2),l.followers=[];for(let n=0;n<3;n++)l.followers.push(new A(l.leader.x,l.leader.y,n));h(1),p(0),b(100),w(3),C("0:00"),E(!1),i(!0)};return o.jsxs("div",{"data-id":"zombie-container",className:"relative w-full h-screen bg-black overflow-hidden font-sans select-none touch-none",children:[o.jsx("canvas",{"data-id":"zombie-canvas",ref:x,className:"block w-full h-full"}),s&&!j&&o.jsxs("div",{"data-id":"zombie-hud",className:"absolute top-0 left-0 w-full p-4 flex justify-between items-start text-white pointer-events-none",children:[o.jsxs("div",{"data-id":"zombie-hud-left",className:"flex flex-col gap-1",children:[o.jsxs("div",{"data-id":"zombie-level",className:"text-2xl font-black text-green-400 drop-shadow-lg",children:["Lv.",r]}),o.jsx("div",{"data-id":"zombie-exp-bar",className:"w-56 h-4 bg-gray-900 rounded-full border border-gray-700 overflow-hidden shadow-inner",children:o.jsx("div",{"data-id":"zombie-exp-fill",className:"h-full bg-gradient-to-r from-green-600 to-green-400 transition-all duration-300",style:{width:`${u/g*100}%`}})}),o.jsxs("div",{"data-id":"zombie-exp-text",className:"text-[10px] text-green-300 font-bold uppercase tracking-wider",children:["EXP: ",Math.floor(u)," / ",Math.floor(g)]})]}),o.jsxs("div",{"data-id":"zombie-hud-right",className:"text-right",children:[o.jsxs("div",{"data-id":"zombie-unit-count",className:"text-xl font-black text-blue-400",children:["수비대: ",M,"명"]}),o.jsxs("div",{"data-id":"zombie-survival-time",className:"text-sm text-gray-400",children:["Survival: ",G]})]})]}),!s&&!j&&o.jsxs("div",{"data-id":"zombie-start",className:"absolute inset-0 flex flex-col items-center justify-center bg-black/80 z-50",children:[o.jsx("h1",{"data-id":"zombie-start-title",className:"text-6xl md:text-8xl text-green-600 font-black mb-4 tracking-tighter text-center drop-shadow-[0_0_30px_rgba(34,197,94,0.6)]",children:"수비대"}),o.jsxs("p",{className:"text-gray-400 mb-8 text-center px-4",children:["화면을 터치/클릭하여 리더를 이동하세요",o.jsx("br",{}),"자동으로 좀비를 공격합니다!"]}),o.jsx("div",{"data-id":"zombie-start-buttons",className:"flex flex-col sm:flex-row gap-4 w-full px-10 max-w-lg",children:o.jsx("button",{"data-id":"zombie-play-btn",onClick:T,className:"flex-1 py-5 bg-green-600 hover:bg-green-500 text-white text-2xl font-bold rounded-3xl transition-all active:scale-95 shadow-xl",children:"방어 시작"})})]}),j&&o.jsxs("div",{"data-id":"zombie-gameover",className:"absolute inset-0 flex flex-col items-center justify-center bg-black/95 z-50",children:[o.jsx("h1",{"data-id":"zombie-gameover-title",className:"text-6xl text-red-700 font-black mb-2 animate-pulse",children:"GAME OVER"}),o.jsx("p",{"data-id":"zombie-gameover-stats",className:"text-white text-2xl mb-6 font-light",children:q}),o.jsx("div",{"data-id":"zombie-gameover-buttons",className:"flex gap-4 w-full px-10 max-w-lg",children:o.jsx("button",{"data-id":"zombie-restart-btn",onClick:T,className:"flex-1 py-4 bg-zinc-800 hover:bg-zinc-700 text-white text-xl font-bold rounded-2xl transition-all",children:"재시작"})})]}),L&&o.jsx("div",{"data-id":"zombie-upgrade-overlay",className:"absolute inset-0 flex items-center justify-center bg-black/90 z-50",children:o.jsxs("div",{"data-id":"zombie-upgrade-modal",className:"bg-zinc-950 p-8 rounded-3xl border-4 border-green-500 max-w-sm w-full shadow-2xl",children:[o.jsx("h2",{"data-id":"zombie-upgrade-title",className:"text-3xl text-green-500 font-black text-center mb-4",children:"레벨 업!"}),o.jsx("div",{"data-id":"zombie-upgrade-options",className:"space-y-4",children:F.map((l,n)=>o.jsxs("div",{"data-id":`zombie-upgrade-option-${n}`,onClick:()=>{l.action(),N(!1),c.current.isPaused=!1},className:"p-4 rounded-2xl bg-zinc-900 hover:bg-zinc-800 border-2 border-zinc-800 hover:border-green-500 cursor-pointer transition-all",children:[o.jsx("div",{className:"text-xl font-bold text-green-400 mb-1",children:l.title}),o.jsx("div",{className:"text-xs text-gray-500",children:l.desc})]},n))})]})})]})}export{B as default};
