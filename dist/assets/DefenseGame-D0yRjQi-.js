import{b as u,j as t}from"./index-CPPkEWNz.js";const C=5,y=70,d=20,h={NORMAL:{name:"ÏùºÎ∞ò",color:"#94a3b8",prob:.65,power:15,sell:20},RARE:{name:"Ìù¨Í∑Ä",color:"#38bdf8",prob:.25,power:35,sell:40},EPIC:{name:"ÏòÅÏõÖ",color:"#a855f7",prob:.08,power:85,sell:100},LEGEND:{name:"Ï†ÑÏÑ§",color:"#fbbf24",prob:.015,power:220,sell:250},MYTHIC:{name:"Ïã†Ìôî",color:"#f43f5e",prob:.005,power:650,sell:1e3}},M=[{id:"MG",name:"Î®∏Ïã†Í±¥",icon:"‚ö°"},{id:"RL",name:"Î†àÏù¥Ï†Ä",icon:"üì°"},{id:"CN",name:"Ï∫êÎÖºÌè¨",icon:"üî•"},{id:"CR",name:"ÎÉâÍ∞ÅÌÉÑ",icon:"‚ùÑÔ∏è"}],b=new(window.AudioContext||window.webkitAudioContext);let g=!1,j=null;const k={LOBBY:[220,0,165,0],BATTLE:[110,165,110,220],BOSS:[55,110,55,165]};let w=0;function x(i,e,s,a=.1,l=0){if(g||b.state==="suspended")return;const n=b.currentTime+l,o=b.createOscillator(),r=b.createGain();o.type=e,o.frequency.setValueAtTime(i,n),r.gain.setValueAtTime(a,n),r.gain.exponentialRampToValueAtTime(.001,n+s),o.connect(r),r.connect(b.destination),o.start(n),o.stop(n+s)}const p={summon:()=>{x(880,"sine",.1,.05)},merge:()=>{x(440,"square",.1,.1),x(880,"square",.2,.05,.1)},upgrade:()=>{[440,660,880].forEach((i,e)=>x(i,"sawtooth",.1,.03,e*.05))},shoot:()=>{x(2500,"square",.02,.003)},buy:()=>{x(1200,"sine",.1,.05)},error:()=>{x(150,"sawtooth",.2,.1)},delete:()=>{x(300,"sawtooth",.1,.05),x(100,"sawtooth",.2,.1,.05)},boss:()=>{x(55,"sawtooth",1,.5)}},N={resume:()=>{b.state==="suspended"&&b.resume()},toggleMute:()=>(g=!g,g),isMuted:()=>g,startBGM:i=>{j&&clearInterval(j),j=setInterval(()=>{if(g||i.isGameOver)return;let e=i.isStarted?i.enemies.some(a=>a.isBoss)?k.BOSS:k.BATTLE:k.LOBBY;const s=e[w%e.length];s>0&&x(s,"triangle",.12,.02),w%4===0&&x(40,"sine",.2,.05),w++},140)}};class E{constructor(e,s,a){this.rankKey=e,this.rank=h[e],this.typeData=s,this.gridPos=a,this.x=d+a.c*y+y/2,this.y=d+a.r*y+y/2+40,this.range=e==="LEGEND"||e==="MYTHIC"?280:210,this.cooldown=0,this.fireRate=e==="MYTHIC"?10:e==="LEGEND"?18:32,this.rotation=0}draw(e,s,a){const l=this.rankKey==="MYTHIC";if(e.save(),e.translate(this.x,this.y),e.fillStyle="#1e293b",e.fillRect(-22,-24,8,48),e.fillRect(14,-24,8,48),e.fillStyle="#334155",e.strokeStyle=this.rank.color,e.lineWidth=1,e.beginPath(),e.roundRect(-16,-20,32,40,4),e.fill(),e.stroke(),e.save(),e.rotate(this.rotation),e.fillStyle="#0f172a",e.strokeStyle=this.rank.color,e.lineWidth=2,e.beginPath(),l)for(let n=0;n<6;n++){const o=n*Math.PI/3,r=15*Math.cos(o),c=15*Math.sin(o);n===0?e.moveTo(r,c):e.lineTo(r,c)}else e.arc(0,0,14,0,Math.PI*2);switch(e.fill(),e.stroke(),e.fillStyle="#475569",this.typeData.id){case"MG":e.fillRect(10,-6,16,4),e.fillRect(10,2,16,4);break;case"RL":e.fillRect(5,-3,22,6),e.fillStyle=this.rank.color,e.beginPath(),e.arc(28,0,4,0,Math.PI*2),e.fill();break;case"CN":e.fillRect(8,-5,24,10),e.fillRect(28,-6,6,12);break;case"CR":e.beginPath(),e.moveTo(8,-6),e.lineTo(25,-10),e.lineTo(25,10),e.lineTo(8,6),e.closePath(),e.fill();break}if(e.restore(),e.restore(),s&&(e.save(),e.beginPath(),e.arc(this.x,this.y,40,0,Math.PI*2),e.strokeStyle="#ef4444",e.lineWidth=2,e.stroke(),e.beginPath(),e.arc(this.x,this.y,this.range,0,Math.PI*2),e.fillStyle="rgba(239, 68, 68, 0.05)",e.fill(),e.fillStyle="white",e.font="bold 12px sans-serif",e.textAlign="center",e.fillText("SELECT",this.x,this.y-45),e.restore()),a){e.save();const n=Date.now()%1e3/1e3,o=.5+Math.sin(n*Math.PI)*.5;e.beginPath(),e.arc(this.x,this.y,35,0,Math.PI*2),e.strokeStyle=`rgba(16, 185, 129, ${o})`,e.lineWidth=3,e.stroke(),e.fillStyle="#10b981",e.font="bold 10px sans-serif",e.textAlign="center",e.fillText("MERGE",this.x,this.y-40),e.restore()}e.fillStyle=this.rank.color,e.font="900 10px Orbitron",e.textBaseline="bottom",e.textAlign="center",e.fillText(this.rank.name,this.x,this.y+35)}update(e,s){if(this.cooldown>0&&this.cooldown--,this.cooldown<=0&&e.enemies.length>0){const a=this.findTarget(e.enemies);if(a){this.shoot(e,a,s),this.cooldown=this.fireRate;const l=a;this.rotation=Math.atan2(l.y-this.y,l.x-this.x)}}}findTarget(e){const s=e.filter(a=>Math.sqrt((a.x-this.x)**2+(a.y-this.y)**2)<=this.range);return s.length===0?null:s.find(a=>a.isBoss)||s[0]}shoot(e,s,a){const l=this.rank.power*(1+(a-1)*.15);e.projectiles.push({x:this.x+Math.cos(this.rotation)*20,y:this.y+Math.sin(this.rotation)*20,tx:s.x,ty:s.y,target:s,power:l,speed:18,color:this.rank.color,type:this.typeData.id}),p.shoot()}}const T=(i,e)=>[{x:d,y:d},{x:i-d,y:d},{x:i-d,y:e-120},{x:d,y:e-120},{x:d,y:d+10}];class R{constructor(e,s=!1,a,l,n,o){this.isBoss=s,this.path=T(l,n);let r=130;a==="EASY"?r=75:a==="NORMAL"&&(r=100);const c=s?13:1+Math.floor(e/5)*.75;this.maxHp=(70+e*r)*c,this.hp=this.maxHp,this.speed=s?.45:Math.min(3.8,1.6+e*.04),this.pathIndex=0,this.x=this.path[0].x,this.y=this.path[0].y,this.radius=14,this.bob=0}update(e){const s=this.path[this.pathIndex+1];if(!s)return!0;const a=s.x-this.x,l=s.y-this.y,n=Math.sqrt(a*a+l*l);if(n<this.speed){if(this.pathIndex++,this.pathIndex>=this.path.length-1)return!0}else this.x+=a/n*this.speed,this.y+=l/n*this.speed;return this.bob=Math.sin(e*.2)*2,!1}draw(e){e.save(),e.translate(this.x,this.y+this.bob);const s=this.isBoss?1.8:1;e.scale(s,s),e.fillStyle="#fecaca",e.beginPath(),e.arc(0,-12,5,0,Math.PI*2),e.fill(),e.fillStyle=this.isBoss?"#ef4444":"#3f6212",e.beginPath(),e.arc(0,-14,6,Math.PI,0),e.fill(),e.fillStyle=this.isBoss?"#7f1d1d":"#365314",e.fillRect(-5,-7,10,12),e.strokeStyle=this.isBoss?"#7f1d1d":"#365314",e.lineWidth=3,e.beginPath(),e.moveTo(-5,-5),e.lineTo(-9,2),e.stroke(),e.beginPath(),e.moveTo(5,-5),e.lineTo(9,2),e.stroke();const a=Math.sin(Date.now()*.01)*3;e.fillStyle="#1a2e05",e.fillRect(-4,5,3,6+a),e.fillRect(1,5,3,6-a),e.fillStyle="#1e293b",e.fillRect(4,-2,12,3),e.restore();const l=this.isBoss?60:30;e.fillStyle="#020617",e.fillRect(this.x-l/2,this.y-25,l,4),e.fillStyle=this.isBoss?"#ef4444":"#10b981",e.fillRect(this.x-l/2,this.y-25,l*(this.hp/this.maxHp),4)}}class L{constructor(e,s){this.canvas=e,this.ctx=e.getContext("2d"),this.callbacks=s,this.canvas.width=y*C+d*2,this.canvas.height=this.canvas.width+100,this.path=[{x:d,y:d},{x:this.canvas.width-d,y:d},{x:this.canvas.width-d,y:this.canvas.height-120},{x:d,y:this.canvas.height-120},{x:d,y:d+10}],this.state={gold:500,skulls:0,life:20,wave:1,units:[],enemies:[],projectiles:[],selectedUnit:null,mergeCandidates:[],enemySpawnTimer:0,waveTimer:0,upgradeLevel:1,interestLevel:0,luckBoost:!1,isGameOver:!1,isStarted:!1,usedCodes:[],playerName:"",difficulty:"NORMAL",animationTick:0,killCount:0,bossSpawned:!1},this.loopId=null,this.lastTime=0}reset(e="NORMAL",s="Agent"){this.state={...this.state,gold:e==="EASY"?500:e==="NORMAL"?300:100,skulls:0,life:20,wave:1,units:[],enemies:[],projectiles:[],selectedUnit:null,mergeCandidates:[],enemySpawnTimer:0,waveTimer:0,upgradeLevel:1,interestLevel:0,luckBoost:!1,isGameOver:!1,isStarted:!0,playerName:s,difficulty:e,animationTick:0,killCount:0,bossSpawned:!1},this.startLoop(),N.startBGM(this.state),this.notifyUpdate()}startLoop(){this.loopId&&cancelAnimationFrame(this.loopId);const e=s=>{this.state.isGameOver||(this.update(),this.draw(),this.loopId=requestAnimationFrame(e))};this.loopId=requestAnimationFrame(e)}stopLoop(){this.loopId&&cancelAnimationFrame(this.loopId)}update(){const e=this.state;if(e.animationTick++,e.isStarted&&(e.enemySpawnTimer++,e.wave%10===0&&!e.bossSpawned?e.enemySpawnTimer>80&&(p.boss(),e.enemies.push(new R(e.wave,!0,e.difficulty,this.canvas.width,this.canvas.height)),e.bossSpawned=!0,e.enemySpawnTimer=0):e.wave%10!==0&&(e.bossSpawned=!1,e.enemySpawnTimer>Math.max(10,60-e.wave)&&(e.enemies.push(new R(e.wave,!1,e.difficulty,this.canvas.width,this.canvas.height)),e.enemySpawnTimer=0)),e.waveTimer++,e.waveTimer>1e3)){e.wave++,e.waveTimer=0;let s=e.difficulty==="EASY"?300:e.difficulty==="NORMAL"?200:150;e.gold+=s+e.interestLevel*100,this.notifyUpdate()}e.projectiles=e.projectiles.filter(s=>{const a=s.tx-s.x,l=s.ty-s.y,n=Math.sqrt(a*a+l*l);if(n<s.speed){if(e.enemies.includes(s.target)&&(s.target.hp-=s.power,s.target.hp<=0)){e.killCount++;let o=e.difficulty==="EASY"?5:e.difficulty==="NORMAL"?2:1;e.gold+=o,e.skulls+=s.target.isBoss?50:1,this.notifyUpdate()}return!1}return s.x+=a/n*s.speed,s.y+=l/n*s.speed,!0}),e.enemies=e.enemies.filter(s=>s.update(e.animationTick)?(e.life-=s.isBoss?5:1,this.notifyUpdate(),e.life<=0&&this.gameOver(),!1):s.hp>0),e.units.forEach(s=>s.update(e,e.upgradeLevel))}draw(){const e=this.ctx,s=this.canvas;e.clearRect(0,0,s.width,s.height),e.strokeStyle="rgba(255,255,255,0.03)",e.beginPath(),this.path.forEach((a,l)=>l===0?e.moveTo(a.x,a.y):e.lineTo(a.x,a.y)),e.stroke(),this.state.projectiles.forEach(a=>{e.save(),e.translate(a.x,a.y);const l=a.tx-a.x,n=a.ty-a.y;e.rotate(Math.atan2(n,l)),e.fillStyle=a.color,e.fillRect(-6,-2,12,4),e.restore()}),this.state.enemies.forEach(a=>a.draw(e)),this.state.units.forEach(a=>{const l=this.state.mergeCandidates&&this.state.mergeCandidates.includes(a);a.draw(e,this.state.selectedUnit===a,l)})}gameOver(){this.state.isGameOver=!0,this.stopLoop(),this.notifyUpdate(),this.callbacks.onGameOver&&this.callbacks.onGameOver(this.state)}handleClick(e,s){const a=this.state.units.find(l=>Math.abs(l.x-e)<35&&Math.abs(l.y-s)<40);if(a)if(this.state.selectedUnit&&this.state.selectedUnit!==a)if(this.state.selectedUnit.rankKey===a.rankKey&&this.state.selectedUnit.typeData.id===a.typeData.id){const l=Object.keys(h),n=l.indexOf(a.rankKey)+1,o=l[n];if(o&&o!=="MYTHIC"){this.state.units=this.state.units.filter(c=>c!==this.state.selectedUnit&&c!==a);const r=new E(o,a.typeData,a.gridPos);this.state.units.push(r),this.state.selectedUnit=r,this.updateMergeCandidates(r),p.merge()}else this.selectUnit(a)}else this.selectUnit(a);else this.state.selectedUnit===a?(this.state.selectedUnit=null,this.state.mergeCandidates=[]):this.selectUnit(a);else this.state.selectedUnit=null,this.state.mergeCandidates=[];this.notifyUpdate()}selectUnit(e){this.state.selectedUnit=e,this.updateMergeCandidates(e)}updateMergeCandidates(e){if(!e){this.state.mergeCandidates=[];return}this.state.mergeCandidates=this.state.units.filter(s=>s!==e&&s.rankKey===e.rankKey&&s.typeData.id===e.typeData.id)}summonUnit(e,s=!1){if(this.state.gold<e||this.state.units.length>=15)return!1;this.state.gold-=e,p.summon();const a=Math.random();let l="NORMAL";const n=this.state.luckBoost?2:1;if(s)a<=.05*n?l="MYTHIC":a<=.2*n?l="LEGEND":a<=.5?l="EPIC":l="RARE";else{let f=0;for(const[m,v]of Object.entries(h)){if(m==="MYTHIC")continue;let S=v.prob;if(this.state.luckBoost&&(m==="LEGEND"||m==="EPIC")&&(S*=1.5),f+=S,a<=f){l=m;break}}}const o=this.state.units.map(f=>`${f.gridPos.r},${f.gridPos.c}`);let r,c;do r=Math.floor(Math.random()*4+1),c=Math.floor(Math.random()*C);while(o.includes(`${r},${c}`));return this.state.units.push(new E(l,M[Math.floor(Math.random()*M.length)],{r,c})),this.notifyUpdate(),!0}handleUpgrade(){this.state.skulls<150||(this.state.skulls-=150,this.state.upgradeLevel++,p.upgrade(),this.notifyUpdate())}sellUnit(e=null){const s=e||this.state.selectedUnit;if(!s)return;const a=Math.floor(s.rank.sell/2),l=Math.floor(s.rank.sell/4);this.state.gold+=a,this.state.skulls+=l,this.state.units=this.state.units.filter(n=>n!==s),this.state.selectedUnit===s&&(this.state.selectedUnit=null),p.delete(),this.notifyUpdate()}buyItem(e){if(!this.state.isStarted||this.state.isGameOver)return;let s=e==="HEAL"?150:e==="INTEREST"?400:800;return this.state.skulls>=s?(this.state.skulls-=s,e==="HEAL"?this.state.life=Math.min(40,this.state.life+5):e==="INTEREST"?this.state.interestLevel++:e==="LUCK"&&(this.state.luckBoost=!0),p.buy(),this.notifyUpdate(),!0):!1}redeemCode(e){if(this.state.usedCodes.includes(e))return!1;const s={ÎîîÌéúÏä§_100:{gold:1e4,skulls:5e3,msg:"ÏµúÏ¢Ö Ï†ÑÏÑ§ Î≥¥Í∏â ÏäπÏù∏!"}};if(s[e]){const a=s[e];return this.state.gold+=a.gold,this.state.skulls+=a.skulls,this.state.usedCodes.push(e),p.buy(),this.notifyUpdate(),!0}return!1}notifyUpdate(){this.callbacks.onStateUpdate&&this.callbacks.onStateUpdate({...this.state})}}function I({onEngineInit:i}){const e=u.useRef(null),s=u.useRef(null);u.useEffect(()=>(e.current&&!s.current&&(s.current=new L(e.current,{onStateUpdate:()=>{},onGameOver:()=>{}}),i&&i(s.current)),()=>{s.current&&s.current.stopLoop()}),[]);const a=l=>{if(!s.current)return;const n=e.current.getBoundingClientRect(),o=l.clientX,r=l.clientY,c=e.current.width/n.width,f=e.current.height/n.height,m=(o-n.left)*c,v=(r-n.top)*f;s.current.handleClick(m,v)};return t.jsxs("div",{"data-id":"game-canvas-container",className:"relative w-full h-full",children:[t.jsx("div",{"data-id":"game-canvas-scanline",className:"absolute w-full h-[2px] bg-red-500/10 pointer-events-none z-10 animate-[scanline_4s_linear_infinite]",style:{animationName:"scanline"}}),t.jsx("canvas",{"data-id":"game-canvas",ref:e,onMouseDown:a,onTouchStart:l=>{const n=l.touches[0];a({clientX:n.clientX,clientY:n.clientY})},className:"bg-slate-900 w-full h-auto touch-none block"})]})}function U({onStart:i}){const[e,s]=u.useState(localStorage.getItem("defense_nickname")||""),a=()=>{if(!e.trim())return alert("ÏΩîÎìúÎ™ÖÏùÑ ÏûÖÎ†•ÌïòÏã≠ÏãúÏò§.");localStorage.setItem("defense_nickname",e),i(e,window.difficulty||"NORMAL")},l=n=>{window.difficulty=n,document.querySelectorAll(".diff-btn").forEach(r=>{r.classList.remove("border-sky-500","text-sky-500","bg-slate-800"),r.classList.add("border-slate-700","text-slate-500","bg-slate-900")});const o=document.getElementById(`diff-${n.toLowerCase()}-btn`);o&&(o.classList.remove("border-slate-700","text-slate-500","bg-slate-900"),o.classList.add("border-sky-500","text-sky-500","bg-slate-800"))};return t.jsxs("div",{"data-id":"start-container",className:"absolute inset-0 bg-slate-950 flex flex-col items-center justify-center p-4 z-40 text-center shadow-2xl overflow-hidden",children:[t.jsxs("div",{"data-id":"start-header",className:"mb-6 fade-in mt-2",children:[t.jsx("h2",{"data-id":"start-title",className:"text-3xl text-red-600 mb-2 font-black italic uppercase tracking-tighter drop-shadow-lg",children:"ÎîîÌéúÏä§ Í∏∞Í∞ë ÌÉ±ÌÅ¨ ÏãúÏä§ÌÖú"}),t.jsx("p",{"data-id":"start-subtitle",className:"text-slate-500 text-[11px] font-bold uppercase tracking-widest",children:"Ìï¥Í≥®ÏùÑ ÏàòÏßëÌïòÏó¨ ÏßÄÌúòÎ∂ÄÏùò ÌÉ±ÌÅ¨ ÏÇ¨Îã®ÏùÑ Í∞ïÌôîÌïòÏã≠ÏãúÏò§"})]}),t.jsxs("div",{"data-id":"start-form",className:"w-full max-w-[340px] flex flex-col gap-3 mb-4",children:[t.jsxs("div",{"data-id":"start-name-wrapper",className:"relative group bg-slate-900 border-2 border-slate-700 rounded-xl p-1 flex items-center",children:[t.jsx("input",{"data-id":"start-name-input",type:"text",id:"name-input",value:e,onChange:n=>s(n.target.value),maxLength:8,placeholder:"Í≤åÏûÑ ÏΩîÎìúÎ™Ö",className:"w-full bg-transparent border-none focus:ring-0 text-center font-bold text-lg text-white placeholder:text-slate-600 h-10"}),e&&t.jsx("button",{"data-id":"start-name-clear-btn",onClick:()=>s(""),className:"absolute right-2 top-1/2 -translate-y-1/2 bg-red-900/30 hover:bg-red-600 text-red-500 hover:text-white text-xs font-bold px-3 py-1 rounded transition-all",children:"ÏÇ≠Ï†ú"})]}),t.jsxs("div",{"data-id":"start-difficulty",className:"grid grid-cols-3 gap-3 h-12",children:[t.jsx("button",{"data-id":"start-easy-btn",id:"diff-easy-btn",onClick:()=>l("EASY"),className:"diff-btn border-2 border-slate-700 bg-slate-900 text-slate-500 rounded-xl font-bold transition-all hover:bg-slate-800 text-sm",children:"Ïâ¨ÏõÄ"}),t.jsx("button",{"data-id":"start-normal-btn",id:"diff-normal-btn",onClick:()=>l("NORMAL"),className:"diff-btn border-2 border-sky-500 bg-slate-800 text-sky-500 rounded-xl font-bold transition-all hover:bg-slate-800 text-sm",children:"Ï§ëÍ∞Ñ"}),t.jsx("button",{"data-id":"start-hard-btn",id:"diff-hard-btn",onClick:()=>l("HARD"),className:"diff-btn border-2 border-slate-700 bg-slate-900 text-slate-500 rounded-xl font-bold transition-all hover:bg-slate-800 text-sm",children:"Ïñ¥Î†§ÏõÄ"})]}),t.jsx("button",{"data-id":"start-play-btn",onClick:a,className:"w-full font-black italic bg-red-700 hover:bg-red-600 text-white text-xl py-3 rounded-xl shadow-lg transition-all active:scale-[0.98] border-b-4 border-red-900 tracking-widest mt-1",children:"Ï†ÑÌà¨ Í∞ÄÎèô"})]}),t.jsxs("div",{"data-id":"start-ranking",className:"w-full max-w-[340px] bg-slate-900/50 rounded-xl p-3 min-h-[100px]",children:[t.jsxs("h3",{"data-id":"start-ranking-title",className:"text-[10px] font-black text-red-500 mb-2 uppercase tracking-tighter flex items-center justify-center gap-2",children:[t.jsx("span",{"data-id":"start-ranking-indicator",className:"w-1.5 h-1.5 rounded-full bg-red-600 animate-pulse"})," Ïã§ÏãúÍ∞Ñ ÏûëÏ†Ñ Î≥¥Í≥† (TOP 5)"]}),t.jsx("div",{"data-id":"start-ranking-content",className:"flex flex-col justify-center items-center h-full",children:t.jsx("div",{"data-id":"start-ranking-loading",className:"text-slate-600 text-[10px] italic",children:"ÏßÄÌúòÎ∂Ä ÌÜµÏã†Îßù Ïó∞Í≤∞ ÎåÄÍ∏∞Ï§ë..."})})]})]})}function A({state:i,onShopClick:e,onInfoClick:s}){const a=()=>{const l=N.toggleMute();document.getElementById("mute-btn-text").innerText=l?"üîá OFF":"üîä ON"};return t.jsxs("div",{"data-id":"hud-container",className:"w-full bg-slate-900 border-x-2 border-t-2 border-slate-700 rounded-t-xl p-3 flex justify-between items-center shadow-lg relative z-10",children:[t.jsxs("div",{"data-id":"hud-left",className:"flex flex-col gap-1",children:[t.jsxs("h1",{"data-id":"hud-title",className:"text-lg md:text-xl text-red-500 tracking-tighter uppercase font-black italic flex items-center gap-2",children:[t.jsx("span",{"data-id":"hud-title-icon",className:"text-2xl",children:"‚ö°"})," ÎîîÌéúÏä§ ",t.jsx("span",{"data-id":"hud-title-subtitle",className:"text-[10px] text-slate-500 not-italic font-bold tracking-widest hidden md:inline-block",children:"Ï†ÑÏà† ÏãúÏä§ÌÖú"})]}),t.jsxs("div",{"data-id":"hud-currency",className:"flex gap-2",children:[t.jsxs("span",{"data-id":"hud-wave",className:"bg-slate-950 px-2 py-1 border border-slate-700 rounded text-[10px] font-bold text-slate-400",children:["WAVE ",t.jsx("span",{"data-id":"hud-wave-value",className:"text-white text-xs ml-1",children:Math.floor(i.wave)})]}),t.jsxs("span",{"data-id":"hud-gold",className:"bg-slate-950 px-2 py-1 border border-yellow-900/30 rounded text-[10px] font-bold text-yellow-500",children:["GOLD ",t.jsx("span",{"data-id":"hud-gold-value",className:"text-white text-xs ml-1",children:Math.floor(i.gold).toLocaleString()})]})]})]}),t.jsxs("div",{"data-id":"hud-right",className:"text-right flex flex-col items-end gap-1",children:[t.jsxs("div",{"data-id":"hud-buttons",className:"flex items-center gap-1 mb-1",children:[t.jsx("button",{"data-id":"hud-home-btn",onClick:()=>window.location.href="/",className:"bg-slate-800 hover:bg-slate-700 w-6 h-6 rounded flex items-center justify-center text-[10px] border border-slate-600 text-slate-400 font-bold transition-colors",children:"üè†"}),t.jsx("button",{"data-id":"hud-info-btn",onClick:s,className:"bg-slate-800 hover:bg-slate-700 w-6 h-6 rounded flex items-center justify-center text-[10px] border border-sky-500/50 text-sky-500 font-bold transition-colors",children:"‚ÑπÔ∏è"}),t.jsx("button",{"data-id":"hud-mute-btn",onClick:a,className:"bg-slate-800 hover:bg-slate-700 px-2 py-0.5 h-6 rounded text-[9px] border border-slate-600 font-bold text-slate-300 uppercase transition-colors",children:t.jsx("span",{id:"mute-btn-text",children:"üîä ON"})}),t.jsx("button",{"data-id":"hud-shop-btn",onClick:e,className:"lg:hidden bg-slate-800 hover:bg-slate-700 px-2 py-0.5 h-6 rounded text-[9px] border border-yellow-500/50 font-bold text-yellow-500 uppercase transition-colors",children:"üõí ÏÉÅÏ†ê"})]}),t.jsxs("div",{"data-id":"hud-stats",className:"flex items-center gap-2",children:[t.jsxs("div",{"data-id":"hud-skulls",className:"bg-slate-950 px-2 py-1 border border-red-900/30 rounded flex items-center gap-1",children:[t.jsx("span",{"data-id":"hud-skulls-label",className:"text-[10px] text-red-500 font-bold",children:"SKULLS"}),t.jsx("span",{"data-id":"hud-skulls-value",className:"text-red-400 font-black text-sm",children:Math.floor(i.skulls).toLocaleString()})]}),t.jsxs("div",{"data-id":"hud-hp",className:"bg-slate-950 px-2 py-1 border border-slate-700 rounded flex items-center gap-1",children:[t.jsx("span",{"data-id":"hud-hp-label",className:"text-[10px] text-slate-500 font-bold",children:"HP"}),t.jsx("span",{"data-id":"hud-hp-value",className:`font-black text-sm ${i.life<=5?"text-red-500 animate-pulse":"text-sky-400"}`,children:i.life})]})]})]})]})}function O({engine:i,state:e}){const[s,a]=u.useState(""),l=o=>{i&&i.buyItem(o)},n=()=>{if(!s.trim())return;const o=s.trim().toUpperCase();i.redeemCode?i.redeemCode(o)?(a(""),alert("ÏΩîÎìú ÏäπÏù∏!")):alert("Ïú†Ìö®ÌïòÏßÄ ÏïäÍ±∞ÎÇò Ïù¥ÎØ∏ ÏÇ¨Ïö©Îêú ÏΩîÎìúÏûÖÎãàÎã§."):console.warn("Engine doesn't support redeemCode yet")};return t.jsxs("div",{"data-id":"shop-container",className:"flex flex-col w-full lg:w-56 gap-4 transition-all duration-500 self-stretch font-tech",children:[t.jsxs("div",{"data-id":"shop-coupon-section",className:"bg-slate-900 border-2 border-slate-800 rounded-xl p-4 flex flex-col gap-2 shadow-2xl",children:[t.jsx("h3",{"data-id":"shop-coupon-title",className:"text-[10px] text-sky-400 uppercase tracking-widest text-center font-bold",children:"Î≥¥Ïïà ÌîÑÎ°úÌÜ†ÏΩú"}),t.jsxs("div",{"data-id":"shop-coupon-form",className:"flex flex-col gap-2",children:[t.jsx("input",{"data-id":"shop-coupon-input",type:"text",placeholder:"ÏΩîÎìú ÏûÖÎ†•...",value:s,onChange:o=>a(o.target.value),className:"w-full text-xs p-2 rounded bg-black border border-slate-700 text-center focus:border-sky-500 outline-none text-white"}),t.jsx("button",{"data-id":"shop-coupon-submit-btn",onClick:n,className:"w-full bg-sky-700 hover:bg-sky-600 text-white text-[11px] font-bold py-2 rounded transition-all shadow-lg",children:"ÏΩîÎìú ÏäπÏù∏"})]})]}),t.jsxs("div",{"data-id":"shop-items-section",className:"bg-slate-900 border-2 border-slate-800 rounded-xl p-4 flex flex-col flex-1 shadow-2xl overflow-y-auto max-h-[400px] custom-scrollbar",children:[t.jsx("h2",{"data-id":"shop-items-title",className:"text-base font-bold text-red-400 mb-4 text-center border-b border-slate-800 pb-2 uppercase tracking-tighter italic",children:"Î≥ëÍ∏∞Ï∞Ω ÏÉÅÏ†ê"}),t.jsxs("div",{"data-id":"shop-items-list",className:"flex flex-col gap-3 text-xs",children:[t.jsxs("button",{"data-id":"shop-heal-btn",onClick:()=>l("HEAL"),className:"group flex flex-col items-center p-3 border-2 border-slate-800 rounded-lg bg-slate-800/30 hover:border-red-500 transition-all active:scale-95",children:[t.jsx("span",{"data-id":"shop-heal-icon",className:"text-2xl mb-1",children:"üîß"}),t.jsx("span",{"data-id":"shop-heal-label",className:"text-[10px] font-bold text-slate-300 text-center",children:"Ïû•Î≤Ω Î≥µÍµ¨ (+5)"}),t.jsx("span",{"data-id":"shop-heal-cost",className:"text-sm font-bold text-red-400 mt-1",children:"üíÄ 150"})]}),t.jsxs("button",{"data-id":"shop-interest-btn",onClick:()=>l("INTEREST"),className:"group flex flex-col items-center p-3 border-2 border-slate-800 rounded-lg bg-slate-800/30 hover:border-red-500 transition-all active:scale-95",children:[t.jsx("span",{"data-id":"shop-interest-icon",className:"text-2xl mb-1",children:"ü™ô"}),t.jsxs("span",{"data-id":"shop-interest-label",className:"text-[10px] font-bold text-slate-300 text-center",children:["Î≥¥Í∏â Ï¶ùÌè≠ (LV.",e.interestLevel,")"]}),t.jsx("span",{"data-id":"shop-interest-cost",className:"text-sm font-bold text-red-400 mt-1",children:"üíÄ 400"})]}),t.jsxs("button",{"data-id":"shop-luck-btn",onClick:()=>l("LUCK"),className:`group flex flex-col items-center p-3 border-2 border-slate-800 rounded-lg bg-slate-800/30 transition-all active:scale-95 ${e.luckBoost?"opacity-50 cursor-not-allowed":"hover:border-red-500"}`,disabled:e.luckBoost,children:[t.jsx("span",{"data-id":"shop-luck-icon",className:"text-2xl mb-1",children:"üöÄ"}),t.jsx("span",{"data-id":"shop-luck-label",className:"text-[10px] font-bold text-slate-300 text-center uppercase tracking-widest",children:"Ï∂úÎ†• ÏµúÏ†ÅÌôî"}),t.jsx("span",{"data-id":"shop-luck-cost",className:"text-sm font-bold text-red-400 mt-1",children:"üíÄ 800"})]})]}),e.killCount>=100&&t.jsxs("div",{"data-id":"shop-secret-code",className:"mt-6 animate-bounce bg-red-900/40 border-2 border-yellow-500 rounded-lg p-3 text-center",children:[t.jsx("p",{"data-id":"shop-secret-label",className:"text-[9px] text-yellow-400 font-bold uppercase mb-1",children:"ÏµúÏ¢Ö Î≥¥Î≥ë ÏÑ¨Î©∏ ÏßÄÏõê ÏΩîÎìú"}),t.jsx("p",{"data-id":"shop-secret-value",className:"text-sm font-black text-yellow-300",children:"ÎîîÌéúÏä§_100"})]})]})]})}function G({engine:i,state:e}){return i?t.jsxs("div",{"data-id":"game-controls-container",className:"w-full bg-slate-900 border-x-2 border-b-2 border-slate-700 rounded-b-xl p-3 flex flex-col gap-2 shadow-lg relative z-10 font-tech animate-in fade-in slide-in-from-top-2",children:[t.jsxs("div",{"data-id":"game-controls-main-actions",className:"grid grid-cols-2 gap-2",children:[t.jsxs("button",{"data-id":"game-controls-summon-btn",onClick:()=>i.summonUnit(50),className:"flex items-center justify-between bg-slate-800 hover:bg-slate-750 border border-slate-600 hover:border-sky-500 p-2 px-3 rounded transition-all active:scale-[0.98] group",children:[t.jsxs("div",{"data-id":"game-controls-summon-info",className:"flex flex-col items-start",children:[t.jsx("span",{"data-id":"game-controls-summon-label",className:"text-[10px] font-bold text-white group-hover:text-sky-400",children:"Ìè¨ÌÉë ÏÑ§Ïπò"}),t.jsx("span",{"data-id":"game-controls-summon-desc",className:"text-[9px] text-slate-500",children:"Í∏∞Î≥∏ Ïú†Îãõ Î∞∞Ïπò"})]}),t.jsx("span",{"data-id":"game-controls-summon-cost",className:"text-xs font-bold text-yellow-500",children:"50 G"})]}),t.jsxs("button",{"data-id":"game-controls-random-btn",onClick:()=>i.summonUnit(300,!0),className:"flex items-center justify-between bg-slate-800 hover:bg-slate-750 border border-red-900/50 hover:border-red-500 p-2 px-3 rounded transition-all active:scale-[0.98] group",children:[t.jsxs("div",{"data-id":"game-controls-random-info",className:"flex flex-col items-start",children:[t.jsx("span",{"data-id":"game-controls-random-label",className:"text-[10px] font-bold text-white group-hover:text-red-400",children:"ÎûúÎç§ ÎΩëÍ∏∞"}),t.jsx("span",{"data-id":"game-controls-random-desc",className:"text-[9px] text-red-900/60 group-hover:text-red-900",children:"Í≥†ÏúÑÌóò Í≥†ÏàòÏùµ"})]}),t.jsx("span",{"data-id":"game-controls-random-cost",className:"text-xs font-bold text-yellow-500",children:"300 G"})]})]}),t.jsxs("div",{"data-id":"game-controls-secondary-actions",className:"grid grid-cols-2 gap-2",children:[t.jsxs("button",{"data-id":"game-controls-upgrade-btn",onClick:()=>i.handleUpgrade(),className:"flex items-center justify-center gap-2 bg-slate-950 border border-slate-700 hover:border-sky-500 p-2 rounded transition-all active:scale-[0.98]",children:[t.jsx("span",{"data-id":"game-controls-upgrade-icon",className:"text-lg",children:"‚ö°"}),t.jsxs("div",{"data-id":"game-controls-upgrade-info",className:"flex flex-col items-start leading-none",children:[t.jsx("span",{"data-id":"game-controls-upgrade-label",className:"text-[10px] font-bold text-slate-300",children:"ÌôîÎ†• Í∞ïÌôî"}),t.jsxs("span",{"data-id":"game-controls-upgrade-cost",className:"text-[9px] text-red-500 font-mono",children:["LV.",e.upgradeLevel," ‚Ä¢ 150 Ìï¥Í≥®"]})]})]}),t.jsxs("button",{"data-id":"game-controls-sell-btn",onClick:()=>i.sellUnit(),disabled:!e.selectedUnit,className:`flex items-center justify-center gap-2 border p-2 rounded transition-all active:scale-[0.98]
                        ${e.selectedUnit?"bg-red-950/50 border-red-500 hover:bg-red-900/50 cursor-pointer":"bg-slate-950 border-slate-800 opacity-50 cursor-not-allowed"}`,children:[t.jsx("span",{"data-id":"game-controls-sell-icon",className:"text-lg",children:"‚ôªÔ∏è"}),t.jsxs("div",{"data-id":"game-controls-sell-info",className:"flex flex-col items-start leading-none",children:[t.jsx("span",{"data-id":"game-controls-sell-label",className:"text-[10px] font-bold text-slate-300",children:"ÌÉ±ÌÅ¨ Ï≤†Í±∞"}),t.jsx("span",{"data-id":"game-controls-sell-cost",className:"text-[9px] text-slate-500",children:e.selectedUnit?`Î∞ò Ìôò: ${Math.floor(e.selectedUnit.rank.sell/2)} G`:"Ïú†Îãõ ÏÑ†ÌÉù ÌïÑÏöî"})]})]})]}),t.jsxs("div",{"data-id":"game-controls-status",className:"flex justify-between items-center bg-black/40 px-2 py-1 rounded text-[9px] font-mono text-slate-500",children:[t.jsx("span",{"data-id":"game-controls-status-label",children:"ÏãúÏä§ÌÖú ÏÉÅÌÉú: Ï†ïÏÉÅ"}),t.jsxs("span",{"data-id":"game-controls-unit-count",children:["Í∞ÄÎèô Ïú†Îãõ: ",t.jsxs("span",{className:e.units.length>=15?"text-red-500 font-bold":"text-sky-500",children:[e.units.length,"/15"]})]})]})]}):null}const P={auth:null,db:null,appId:"local-mode",currentUser:{uid:"local-user",isAnonymous:!0},init:async()=>{console.log("Firebase disabled (Local Mode)")},saveScore:async i=>{console.log("Score saving disabled (Local Mode)",i.skulls)},getRankings:async()=>(console.log("Rankings disabled (Local Mode)"),[{uid:"cpu1",name:"Alpha",skulls:5e3,difficulty:"HARD"},{uid:"cpu2",name:"Bravo",skulls:3e3,difficulty:"NORMAL"},{uid:"cpu3",name:"Charlie",skulls:1e3,difficulty:"EASY"}])};function B({state:i,onRestart:e}){return u.useEffect(()=>{i.isGameOver&&P.saveScore(i)},[i.isGameOver]),i.isGameOver?t.jsxs("div",{"data-id":"gameover-container",className:"absolute inset-0 bg-black/95 flex flex-col items-center justify-center rounded-lg z-50 text-center p-6 border-4 border-red-900 font-tech animate-in fade-in zoom-in duration-300",children:[t.jsx("h2",{"data-id":"gameover-title",className:"text-4xl font-black text-red-600 mb-2 italic uppercase tracking-widest",children:"System Down"}),t.jsxs("div",{"data-id":"gameover-stats",className:"mb-6 text-center",children:[t.jsxs("p",{"data-id":"gameover-wave",className:"text-sm text-slate-400 font-bold uppercase mb-1",children:["Last Wave: ",Math.floor(i.wave)]}),t.jsxs("p",{"data-id":"gameover-skulls",className:"text-5xl text-red-500 font-black italic",children:["üíÄ ",Math.floor(i.skulls).toLocaleString()]})]}),t.jsx("div",{"data-id":"gameover-actions",className:"flex flex-col gap-3 w-full max-w-[220px]",children:t.jsx("button",{"data-id":"gameover-restart-btn",onClick:()=>window.location.reload(),className:"bg-red-700 hover:bg-red-600 text-white py-3 rounded font-black text-lg shadow-lg uppercase transition-all",children:"Îã§ÏãúÌïòÍ∏∞"})})]}):null}function D({onClose:i}){return t.jsx("div",{"data-id":"gameinfo-overlay",className:"fixed inset-0 z-50 bg-black/80 flex items-center justify-center p-4 animate-in fade-in",onClick:i,children:t.jsxs("div",{"data-id":"gameinfo-container",className:"bg-slate-900 border-2 border-slate-700 rounded-xl max-w-sm w-full p-4 shadow-2xl relative",onClick:e=>e.stopPropagation(),children:[t.jsx("button",{"data-id":"gameinfo-close-btn",onClick:i,className:"absolute top-2 right-3 text-slate-500 hover:text-white font-bold text-xl",children:"‚úï"}),t.jsxs("h2",{"data-id":"gameinfo-title",className:"text-lg font-black text-white italic uppercase mb-4 border-b border-slate-700 pb-2 flex items-center gap-2",children:[t.jsx("span",{"data-id":"gameinfo-title-icon",className:"text-yellow-500",children:"‚ÑπÔ∏è"})," ÏûëÏ†Ñ Í∞ÄÏù¥Îìú"]}),t.jsxs("div",{"data-id":"gameinfo-content",className:"space-y-4 font-tech text-xs",children:[t.jsxs("div",{"data-id":"gameinfo-gacha-section",children:[t.jsx("h3",{"data-id":"gameinfo-gacha-title",className:"font-bold text-sky-400 mb-2 uppercase",children:"üìä ÏÜåÌôò ÌôïÎ•† (300G)"}),t.jsxs("div",{"data-id":"gameinfo-gacha-grid",className:"grid grid-cols-2 gap-2",children:[t.jsxs("div",{"data-id":"gameinfo-standard-draw",className:"bg-slate-950 p-2 rounded border border-slate-800",children:[t.jsx("div",{"data-id":"gameinfo-standard-title",className:"text-[10px] text-slate-500 font-bold mb-1 text-center",children:"ÏùºÎ∞ò ÏÜåÌôò (Í∏∞Î≥∏)"}),t.jsxs("div",{"data-id":"gameinfo-standard-normal",className:"flex justify-between px-2 text-slate-300",children:[t.jsx("span",{children:h.NORMAL.name}),t.jsxs("span",{className:"font-mono",children:[h.NORMAL.prob*100,"%"]})]}),t.jsxs("div",{"data-id":"gameinfo-standard-rare",className:"flex justify-between px-2 text-sky-300",children:[t.jsx("span",{children:h.RARE.name}),t.jsxs("span",{className:"font-mono",children:[h.RARE.prob*100,"%"]})]}),t.jsxs("div",{"data-id":"gameinfo-standard-epic",className:"flex justify-between px-2 text-purple-300",children:[t.jsx("span",{children:h.EPIC.name}),t.jsxs("span",{className:"font-mono",children:[h.EPIC.prob*100,"%"]})]}),t.jsxs("div",{"data-id":"gameinfo-standard-legend",className:"flex justify-between px-2 text-yellow-300",children:[t.jsx("span",{children:h.LEGEND.name}),t.jsxs("span",{className:"font-mono",children:[h.LEGEND.prob*100,"%"]})]})]}),t.jsxs("div",{"data-id":"gameinfo-lucky-draw",className:"bg-red-950/20 p-2 rounded border border-red-900/50",children:[t.jsx("div",{"data-id":"gameinfo-lucky-title",className:"text-[10px] text-red-400 font-bold mb-1 text-center",children:"ÎûúÎç§ ÎΩëÍ∏∞ (300G)"}),t.jsxs("div",{"data-id":"gameinfo-lucky-mythic",className:"flex justify-between px-2 text-red-300",children:[t.jsx("span",{children:h.MYTHIC.name}),t.jsx("span",{className:"font-mono",children:"5%"})]}),t.jsxs("div",{"data-id":"gameinfo-lucky-legend",className:"flex justify-between px-2 text-yellow-300",children:[t.jsx("span",{children:h.LEGEND.name}),t.jsx("span",{className:"font-mono",children:"15%"})]}),t.jsxs("div",{"data-id":"gameinfo-lucky-epic",className:"flex justify-between px-2 text-purple-300",children:[t.jsx("span",{children:h.EPIC.name}),t.jsx("span",{className:"font-mono",children:"30%"})]}),t.jsxs("div",{"data-id":"gameinfo-lucky-rare",className:"flex justify-between px-2 text-sky-300",children:[t.jsx("span",{children:h.RARE.name}),t.jsx("span",{className:"font-mono",children:"50%"})]})]})]}),t.jsx("p",{"data-id":"gameinfo-luck-note",className:"text-[9px] text-slate-500 mt-1 italic text-center",children:"* ÌñâÏö¥(Luck) ÏïÑÏù¥ÌÖú Î≥¥Ïú† Ïãú ÌôïÎ•† ÏÉÅÏäπ"})]}),t.jsxs("div",{"data-id":"gameinfo-controls-section",children:[t.jsx("h3",{"data-id":"gameinfo-controls-title",className:"font-bold text-sky-400 mb-2 uppercase",children:"üéÆ Ï°∞ÏûëÎ≤ï"}),t.jsxs("ul",{"data-id":"gameinfo-controls-list",className:"list-disc pl-4 space-y-1 text-slate-300",children:[t.jsxs("li",{"data-id":"gameinfo-control-merge",children:[t.jsx("span",{className:"text-white font-bold",children:"Ìï©ÏÑ±:"})," Í∞ôÏùÄ Îì±Í∏â/Ï¢ÖÎ•ò Ïú†Îãõ ÌÑ∞Ïπò ‚Üí ÎÖπÏÉâÏúºÎ°ú ÎπõÎÇòÎäî Ïú†Îãõ ÌÑ∞Ïπò"]}),t.jsxs("li",{"data-id":"gameinfo-control-sell",children:[t.jsx("span",{className:"text-white font-bold",children:"ÌåêÎß§:"})," Ïú†Îãõ ÎçîÎ∏î ÌÑ∞Ïπò (Îπ†Î•∏ ÌåêÎß§)"]}),t.jsxs("li",{"data-id":"gameinfo-control-move",children:[t.jsx("span",{className:"text-white font-bold",children:"Ïù¥Îèô:"})," Ïú†ÎãõÏùÄ ÏûêÎèô Í≥µÍ≤©Ìï©ÎãàÎã§. ÏúÑÏπò ÏÑ†Ï†ï Ï§ëÏöî!"]})]})]})]})]})})}function H(){const[i,e]=u.useState(null),[s,a]=u.useState(null),[l,n]=u.useState(!1),[o,r]=u.useState(!1),c=(f,m)=>{i&&(i.reset(m,f),N.resume())};return t.jsxs("div",{"data-id":"defense-container",className:"flex flex-col lg:flex-row gap-6 items-center justify-center min-h-screen p-2 md:p-4 overflow-x-hidden bg-[#0f172a]",children:[o&&t.jsx(D,{onClose:()=>r(!1)}),s?.isStarted&&t.jsxs("div",{"data-id":"defense-shop-overlay",className:`
              fixed inset-0 z-50 bg-black/95 p-4 flex flex-col items-center justify-center transition-all duration-300
              lg:static lg:bg-transparent lg:p-0 lg:w-auto lg:h-auto lg:block
              ${l?"opacity-100 pointer-events-auto":"opacity-0 pointer-events-none lg:opacity-100 lg:pointer-events-auto hidden lg:flex"}
          `,children:[t.jsx("button",{"data-id":"defense-shop-close-btn",onClick:()=>n(!1),className:"lg:hidden absolute top-4 right-4 text-white text-2xl font-bold p-2 hover:text-red-500 transition-colors",children:"‚úï"}),t.jsx(O,{engine:i,state:s})]}),t.jsxs("div",{"data-id":"defense-game-frame",className:"flex flex-col items-center relative w-full max-w-[500px]",children:[s?.isStarted&&t.jsx(A,{state:s,onShopClick:()=>n(!0),onInfoClick:()=>r(!0)}),t.jsxs("div",{"data-id":"defense-screen",className:`relative w-full aspect-square md:aspect-auto bg-black border-x-2 border-slate-700 ${s?.isStarted?"":"rounded-xl border-y-2"}`,children:[t.jsx(I,{onEngineInit:f=>{f.callbacks={onStateUpdate:m=>a({...m}),onGameOver:m=>a({...m})},e(f),a({...f.state})}}),(!s||!s.isStarted)&&t.jsx(U,{onStart:c}),s?.isGameOver&&t.jsx(B,{state:s})]}),s?.isStarted&&t.jsx(G,{engine:i,state:s})]})]})}export{H as default};
